<!DOCTYPE hibernate-mapping PUBLIC
        "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
        "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">

<hibernate-mapping>
	<class name="org.LexGrid.concepts.Entity" table="entity" lazy="true"
		where="codingSchemeName = '@CODING_SCHEME_NAME@'"
		polymorphism="explicit">
		
		<cache usage="read-write"/>

		<composite-id
			class="org.LexGrid.LexBIG.caCore.hibernate.compositeKeys.EntityKey">
			<key-property name="codingSchemeName" />
			<key-property name="entityCodeNamespace" />
			<key-property name="entityCode" />
		</composite-id>

		<!-- Versionable (con't on bottom)-->
		<property name="_isActive" insert="false" update="false"
			access="field" type="boolean" column="isActive" />
			
		<!-- VersionableAndDescribable -->
		<one-to-one name="_entityDescription" access="field"
			class="org.LexGrid.commonTypes.EntityDescription$Entity">
			<formula>entityCode</formula>
			<formula>codingSchemeName</formula>
		</one-to-one>

		<bag name="_entityTypeList" access="field" table="entityType"
			lazy="false" cascade="all">
			<key>
				<column name="codingSchemeName" />
				<column name="entityCodeNamespace" />
				<column name="entityCode" />
			</key>
			<element type="string" column="entityType" />
		</bag>

		<!-- Entity -->
		<property name="_entityCode" insert="false" update="false"
			access="field" column="entityCode" />
		<property name="_entityCodeNamespace" insert="false"
			update="false" access="field" column="entityCodeNamespace" />
		<property name="_isAnonymous" insert="false" update="false"
			access="field" type="boolean" column="isAnonymous" />
		<property name="_isDefined" insert="false" update="false"
			access="field" type="boolean" column="isDefined" />

		<bag name="_presentationList" access="field"
			where="propertyType = 'presentation'" table="entity" lazy="true">
			<key>
				<column name="codingSchemeName" />
				<column name="entityCodeNamespace" />
				<column name="entityCode" />
			</key>
			<one-to-many
				class="org.LexGrid.concepts.Presentation$Entity" />
		</bag>

		<bag name="_definitionList" access="field"
			where="propertyType = 'definition'" table="entity" lazy="true">
			<key>
				<column name="codingSchemeName" />
				<column name="entityCodeNamespace" />
				<column name="entityCode" />
			</key>
			<one-to-many class="org.LexGrid.concepts.Definition$Entity" />
		</bag>

		<bag name="_commentList" access="field"
			where="propertyType = 'comment'" table="entity" lazy="true">
			<key>
				<column name="codingSchemeName" />
				<column name="entityCodeNamespace" />
				<column name="entityCode" />
			</key>
			<one-to-many class="org.LexGrid.concepts.Comment$Entity" />
		</bag>

		<bag name="_propertyList" access="field"
			where="propertyType = 'property'" table="entity" lazy="true">
			<key>
				<column name="codingSchemeName" />
				<column name="entityCodeNamespace" />
				<column name="entityCode" />
			</key>
			<one-to-many
				class="org.LexGrid.commonTypes.Property$Entity" />
		</bag>

		<bag name="_propertyLinkList" access="field"
			table="entityPropertyLink" lazy="true">
			<key>
				<column name="codingSchemeName" />
				<column name="entityCodeNamespace" />
				<column name="entityCode" />
			</key>
			<one-to-many class="org.LexGrid.concepts.PropertyLink" />
		</bag>
	
		<!-- Versionable -->  
		<property name="_status" access="field" lazy="true">
			<formula>(select @PREFIX@entryState.status from @PREFIX@entryState where
			 @PREFIX@entryState.entryStateId = entryStateId)</formula>
		</property>
		
		<property name="_effectiveDate" type="date" access="field" lazy="true">
			<formula>(select @PREFIX@entryState.effectiveDate from @PREFIX@entryState where
			 @PREFIX@entryState.entryStateId = entryStateId)</formula>
		</property>
		
		<property name="_expirationDate" type="date" access="field" lazy="true">
			<formula>(select @PREFIX@entryState.expirationDate from @PREFIX@entryState where
			@PREFIX@entryState.entryStateId = entryStateId)</formula>
		</property>
		
		<many-to-one name="_owner" access="field" not-found="ignore"
			class="org.LexGrid.commonTypes.Source$EntryState">
			<formula>entryStateId</formula>
		</many-to-one>
		 
		<many-to-one name="_entryState" access="field" not-found="ignore"
			class="org.LexGrid.versions.EntryState">
			<formula>entryStateId</formula>
		</many-to-one>	
		
	</class>

</hibernate-mapping>